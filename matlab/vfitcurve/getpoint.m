% 绘制三种类型的B样条曲线，需要前面所给的所有.m文件
clear all;
plan=9;
switch plan
    case 2
        % 控制顶点
        % 火焰
        P{1}=[91.5,414.2;122,244;232,86;358.5,9];
        P{2}=[358.5,9;260,172;405,277;357.4,479.5];
        P{3}=[357.4,479.5;398,412;428,333;421.1,201.3];
        P{4}=[421.1,201.3;482,258;509,324;529.3,406.4];
        P{5}=[529.3,406.4;543,386;554,366;567.1,358.3];
        P{6}=[567.1,358.3;525,502;728,515;459.9,751.1];
        P{7}=[459.9,751.1;544,571.5;475,485;443.9,456.4];
        P{8}=[443.9,456.4;425,538.5;393,614.4;341.6,666.6];
        P{9}=[341.6,666.6;318,502;269,555;256.2,292.2];
        P{10}=[256.2,292.2;234,349;199.5,444;185,493.4];
        P{11}=[185,493.4;176,481;163,462;155.1,460.7];
        P{12}=[155.1,460.7;195.5,561.5;58.5,618;159,746.2];
        P{13}=[159,746.2;-121,530;96,486;46,358.2];
        P{14}=[46,358.2;69.5,380;73,384;91.5,414.2];
    case 1
        % 鸟
        P{1}=[302.9,302.2;278,167.5;432,106;512,190];
        P{2}=[512,190;547,183;570,172;589,161];
        P{3}=[589,161;580,191;564,211;536,228];
        P{4}=[536,228;565,224;579,221;606,209];
        P{5}=[606,209;594,228;572,254;545,273];
        P{6}=[545,273;546,573;252,729;9,582];
        P{7}=[9,582;72,588;129,578;190,531];
        P{8}=[190,531;132,529;90,487;75,446];
        P{9}=[75,446;92,450;114,450;131,444];
        P{10}=[131,444;56,429;31,362;33,321];
        P{11}=[33,321;45,330;32,339;87,338];
        P{12}=[87,338;20,291;29,210;50,175];
        P{13}=[50,175;95,231;176,296;302.9,302.2];
    case 3
        % 叶子
        P{1}=[311,86;332,174;373,212;429,179];
        P{2}=[429,179;406,219;401,262;404,323];
        P{3}=[404,323;404,323;470,264;470,264];
        P{4}=[470,264;481,308;524,311;561,301];
        P{5}=[561,301;531,372;569,402;597,415];
        P{6}=[597,415;550,427;445,479;462,594];
        P{7}=[462,594;418,541;367,535;316,568];
        P{8}=[316,568;316,568;316,681;316,681];
        P{9}=[316,681;316,681;302,681;302,681];
        P{10}=[302,681;302,681;302,565;302,565];
        P{11}=[302,565;273,542;205,552;153,581];
        P{12}=[153,581;181,495;92,432;14,408];
        P{13}=[14,408;61,402;82,379;68,300];
        P{14}=[68,300;118,318;148,308;156,240];
        P{15}=[156,240;163,276;162,287;217,324];
        P{16}=[217,324;232,283;207,208;196,187];
        P{17}=[196,187;246,199;294,180;311,86];
        
    case 4
        
        
        % 狮子
        P{1}=[192,49;192,49;190,44;190,44];
        P{2}=[190,44;190,44;197,36;197,36];
        P{3}=[197,36;197,36;194,34;194,34];
        P{4}=[194,34;194,34;219,21;219,21];
        P{5}=[219,21;219,21;215,19;215,19];
        P{6}=[215,19;215,19;239,12;239,12];
        P{7}=[239,12;239,12;236,10;236,10];
        P{8}=[236,10;236,10;260,6;260,6];
        P{9}=[260,6;260,6;256,4;256,4];
        P{10}=[256,4;275,2;292,12;295,18];
        P{11}=[295,18;294,24;298,25;298,28];
        P{12}=[298,28;311,37;313,40;311,44];
        P{13}=[311,44;303,61;302,62;287,55];
        P{14}=[287,55;285,57;282,64;280,75];
        P{15}=[280,75;280,75;277,73;277,73];
        P{16}=[277,73;277,73;273,97;273,97];
        P{17}=[273,97;273,97;270,95;270,95];
        P{18}=[270,95;265,111;265,114;257,114];
        P{19}=[257,114;257,155;259,192;271,184];
        P{20}=[271,184;275,188;276,194;275,195];
        P{21}=[275,195;275,195;251,195;251,195];
        P{22}=[251,195;241,166;240,162;236,143];
        P{23}=[236,143;226,182;223,187;233,185];
        P{24}=[233,185;236,188;239,192;237,195];
        P{25}=[237,195;237,195;213,195;213,195];
        P{26}=[213,195;213,195;209,123;209,123];
        P{27}=[209,123;163,138;139,115;134,117];
        P{28}=[134,117;119,167;122,167;129,185];
        P{29}=[129,185;139,184;140,186;141,195];
        P{30}=[141,195;141,195;117,195;117,195];
        P{31}=[117,195;98,155;106,148;103,137];
        P{32}=[103,137;88,157;87,184;88,185];
        P{33}=[88,185;98,184;99,185;100,195];
        P{34}=[100,195;100,195;76,195;76,195];
        P{35}=[76,195;73,179;72,158;79,129];
        P{36}=[79,129;56,182;5,159;12,135];
        P{37}=[12,135;25,139;31,158;51,146];
        P{38}=[51,146;67,134;69,113;70,97];
        P{39}=[70,97;79,30;135,52;192,49];
    case 5
        %凤凰
        P{1}=[317,219;212,169;209,408;431,367];
        P{2}=[431,367;397,366;391,363;344,336];
        P{3}=[344,336;385,329;418,341;440,356];
        P{4}=[440,356;426,340;406,327;390,301];
        P{5}=[390,301;417,313;438,338;459,369];
        P{6}=[459,369;426,325;459,285;502,278];
        P{7}=[502,278;486,282;449,319;472,347];
        P{8}=[472,347;469,340;463,309;499,297];
        P{9}=[499,297;491,301;466,329;483,354];
        P{10}=[483,354;482,338;484,328;489,320];
        P{11}=[489,320;485,365;504,364;512,364];
        P{12}=[512,364;544,363;544,338;569,345];
        P{13}=[569,345;569,341;568,337;544,336];
        P{14}=[544,336;554,332;573 332;579 345];
        P{15}=[579 345;577 324;531 331;531 287];
        P{16}=[531 287;538 318;556 316;580 332];
        P{17}=[580 332;594 344;581 357;590 369];
        P{18}=[590 369;538,346;574 455;477 409];
        P{19}=[477 409;450 395;423 427;462 444];
        P{20}=[462 444;445 444;425 432;433 402];
        P{21}=[433 402;424 408;403 464;487 462];
        P{22}=[487 462;449 480;383 447;424 391];
        P{23}=[424 391;351 463;491 538;518 449];
        P{24}=[518 449;515 533;396 509;388 449];
        P{25}=[388 449;348 520;321 530;196 470];
        P{26}=[196 470;149 443;132 452;123 460];
        P{27}=[123 460;116 469;85 478;104 455];
        P{28}=[104 455;63 463;107 488;81 493];
        P{29}=[81 493;49 491;69 430;139 443];
        P{30}=[139 443;87 414;36 426;28 480];
        P{31}=[28 480;32 373;131 420;220 457];
        P{32}=[220 457;204 448;183 426;181 400];
        P{33}=[181 400;178 368;214 367;214 380];
        P{34}=[214 380;210 402;183 385;196 416];
        P{35}=[196 416;211 387;217 428;214 443];
        P{36}=[214 443;232 468;319 512;350 457];
        P{37}=[350 457;317 488;230 443;230 426];
        P{38}=[230 426;301 482;364 433;405 381];
        P{39}=[405 381;399 383;384 384;379 391];
        P{40}=[379 391;362 416;344 400;331 426];
        P{41}=[331 426;329 405;341 399;349 391];
        P{42}=[349 391;309 391;335 432;276 419];
        P{43}=[276 419;312 416;282 398;315 387];
        P{44}=[315 387;281 380;267 421;242 412];
        P{45}=[242 412;263 399;235 368;272 370];
        P{46}=[272 370;259 356;242 361;236 361];
        P{47}=[236 361;226 361;199 348;212 322];
        P{48}=[212 322;216 338;230 343;233 336];
        P{49}=[233 336;239 326;200 278;150 289];
        P{50}=[150 289;90 306;100 348;116 352];
        P{51}=[116 352;127 317;154 361;123 361];
        P{52}=[123 361;108 360;82 328;112 298];
        P{53}=[112 298;101 299;95 285;87 298];
        P{54}=[87 298;87 265;127 286;134 284];
        P{55}=[134 284;116 264;137 270;129 247];
        P{56}=[129 247;156 249;131 268;167 279];
        P{57}=[167 279;168 276;159 257;164 251];
        P{58}=[164 251;175 256;179 277;193 285];
        P{59}=[193 285;191 285;187 273;190 258];
        P{60}=[190 258;205 267;221 287;219 298];
        P{61}=[219 298;232 302;241 318;245 339];
        P{62}=[245 339;293 391;354 384;373 380];
        P{63}=[373 380;167 367;225 152;317 219];
        
        
        
        %
        % %一段
        % P{1}=[358.5,9;260,172;405,277;357.4,479.5];
        
        
        %
        % %两段
        % P{1}=[91.5,414.2;122,244;232,86;358.5,9];
        % P{2}=[358.5,9;260,172;405,277;91.5,414.2];
    case 6
        %蝴蝶1
        P{1}=[110,148;139,126;153,124;170,125];
        P{end+1}=[170,125;204,127;206,135;204,137];
        P{end+1}=[204,137;200,150;192,144;193,150];
        P{end+1}=[193,150;190,151;187,152;187,156];
        P{end+1}=[187,156;185,155;180,158;180,162];
        P{end+1}=[180,162;177,161;174,162;175,167];
        P{end+1}=[175,167;172,166;170,168;172,171];
        P{end+1}=[172,171;170,170;167,171;167,174];
        P{end+1}=[167,174;160,173;159,178;166,178];
        P{end+1}=[166,178;163,180;164,183;166,184];
        P{end+1}=[166,184;163,184;163,189;165,191];
        P{end+1}=[165,191;163,190;160,193;162,198];
        P{end+1}=[162,198;160,196;156,200;159,206];
        P{end+1}=[159,206;152,203;151,221;153,224];
        P{end+1}=[153,224;156,236;148,238;147,219];
        P{end+1}=[147,219;147,211;140,210;138,214];
        P{end+1}=[138,214;131,203;128,219;122,208];
        P{end+1}=[122,208;120,206;115,207;114,203];
        P{end+1}=[114,203;113,197;118,189;109,168];
        P{end+1}=[109,168;111,191;108,197;103,201];
        %         P{21}=[103,201;97,193;96,190;98,168];
        %         P{22}=[98,168;89,187;93,197;92,203];
        %         P{23}=[92,203;92,206;86,205;83,211];
        %         P{24}=[83,211;79,216;74,204;69,214];
        %         P{25}=[69,214;65,209;59,212;59,220];
        %         P{26}=[59,220;59,237;51,237;54,224];
        %         P{27}=[54,224;55,214;52,203;47,206];
        %         P{28}=[47,206;50,202;48,196;44,198];
        %         P{29}=[44,198;46,194;44,190;42,191];
        %         P{30}=[42,191;43,187;43,184;40,184];
        %         P{31}=[40,184;46,178;37,178;43,177];
        %         P{32}=[43,177;47,176;46,172;40,175];
        %         P{33}=[40,175;36,166;34,175;35,168];
        %         P{34}=[35,168;33,164;30,169;31,164];
        %         P{35}=[31,164;30,159;24,164;26,160];
        %         P{36}=[26,160;21,152;20,160;20,155];
        %         P{37}=[20,155;17,148;12,152;13,148];
        %         P{38}=[13,148;13,145;7,148;3,137];
        %         P{39}=[3,137;-1,131;14,126;34,125];
        %         P{40}=[34,125;48,124;64,124;97,148];
        P{end+1}=[103,201;97,197;95,191;97,168];
        P{end+1}=[97,168;88,189;92,197;91,203];
        P{end+1}=[91,203;91,207;86,206;84,208];
        P{end+1}=[84,208;78,219;75,203;68,214];
        P{end+1}=[68,214;66,210;59,211;59,219];
        P{end+1}=[59,219;58,238;50,236;53,224];
        P{end+1}=[53,224;55,221;54,203;47,206];
        P{end+1}=[47,206;50,200;45,196;44,198];
        P{end+1}=[44,198;46,193;42,190;41,191];
        P{end+1}=[41,191;43,189;43,184;40,184];
        P{end+1}=[40,184;42,183;43,180;40,178];
        P{end+1}=[40,178;47,177;46,172;40,175];
        P{end+1}=[40,175;39,171;36,170;34,171];
        P{end+1}=[34,171;36,167;33,166;31,167];
        P{end+1}=[31,167;32,162;29,162;26,162];
        P{end+1}=[26,162;26,158;21,155;19,156];
        P{end+1}=[19,156;19,152;16,150;13,150];
        P{end+1}=[13,150;14,144;6,150;3,137];
        P{end+1}=[3,137;0,135;2,127;36,125];
        P{end+1}=[36,125;53,124;67,127;97,148];
        P{end+1}=[97,148;97,145;100,144;97,142];
        P{end+1}=[97,142;96,140;97,138;99,138];
        P{end+1}=[99,138;98,134;99,131;98,125];
        P{end+1}=[98,125;97,119;90,110;83,117];
        P{end+1}=[83,117;81,120;82,123;78,123];
        P{end+1}=[78,123;76,122;80,120;81,119];
        P{end+1}=[81,119;82,116;88,110;95,117];
        P{end+1}=[95,117;103,126;98,134;100,137];
        P{end+1}=[100,137;102,138;101,136;103,136];
        P{end+1}=[103,136;105,136;104,138;106,137];
        P{end+1}=[106,137;108,134;104,126;111,117];
        P{end+1}=[111,117;119,110;124,116;126,119];
        P{end+1}=[126,119;126,120;130,122;128,123];
        P{end+1}=[128,123;124,123;125,120;124,118];
        P{end+1}=[124,118;116,110;109,119;108,125];
        P{end+1}=[108,125;107,131;109,133;107,138];
        P{end+1}=[107,138;109,138;110,140;109,142];
        P{end+1}=[109,142;107,145;110,145;110,148];
    case 7
        %鸟2
        P{1}=[9,193;25,189;12,190;12,186];
        P{end+1}=[12,186;12,182;15,192;31,186];
        P{end+1}=[31,186;33,181;36,184;44,183];
        P{end+1}=[44,183;55,184;49,181;58,183];
        P{end+1}=[58,183;66,185;65,182;71,184];
        P{end+1}=[71,184;59,175;62,183;41,163];
        P{end+1}=[41,163;-5,99;31,87;23,55];
        P{end+1}=[23,55;9,51;11,49;4,48];
        P{end+1}=[4,48;4,46;15,42;23,41];
        P{end+1}=[23,41;25,37;36,31;54,40];
        P{end+1}=[54,40;68,47;61,61;84,80];
        P{end+1}=[84,80;112,91;143,148;154,175];
        P{end+1}=[154,175;164,197;162,196;197,237];
        P{end+1}=[197,237;216,253;197,249;189,238];
        P{end+1}=[189,238;197,248;196,270;188,251];
        P{end+1}=[188,251;159,208;159,200;153,200];
        P{end+1}=[153,200;136,192;139,196;126,191];
        P{end+1}=[126,191;114,185;117,189;102,191];
        P{end+1}=[102,191;100,194;92,189;88,189];
        P{end+1}=[88,189;87,191;91,191;94,192];
        P{end+1}=[94,192;114,198;114,214;83,201];
        P{end+1}=[83,201;44,185;30,196;24,197];
        P{end+1}=[24,197;7,199;4,213;9,193];
    case 8
        %huacao4
        P{1}=[140,232;131,228;111,209;102,185];
        P{end+1}=[102,185;100,185;98,181;93,180];
        P{end+1}=[93,180;89,186;76,189;73,188];
        P{end+1}=[73,188;67,185;69,183;62,180];
        P{end+1}=[62,180;60,178;56,178;55,175];
        P{end+1}=[55,175;43,173;54,171;45,170];
        P{end+1}=[45,170;45,165;53,168;56,163];
        P{end+1}=[56,163;61,163;66,158;72,161];
        P{end+1}=[72,161;77,165;81,162;90,169];
        P{end+1}=[90,169;92,175;96,180;101,182];
        P{end+1}=[101,182;92,161;83,138;80,132];
        P{end+1}=[80,132;72,131;75,136;66,140];
        P{end+1}=[66,140;69,146;64,147;63,149];
        P{end+1}=[63,149;61,147;53,147;57,138];
        P{end+1}=[57,138;48,146;47,140;44,139];
        P{end+1}=[44,139;45,138;44,128;54,132];
        P{end+1}=[54,132;47,128;51,121;54,119];
        P{end+1}=[54,119;55,121;62,120;61,126];
        P{end+1}=[61,126;75,124;69,132;79,130];
        P{end+1}=[79,130;58,85;47,81;46,90];
        P{end+1}=[46,90;46,93;45,94;41,93];
        P{end+1}=[41,93;48,100;44,102;44,104];
        P{end+1}=[44,104;43,103;36,103;36,95];
        P{end+1}=[36,95;34,100;30,97;27,94];
        P{end+1}=[27,94;27,92;25,86;32,89];
        P{end+1}=[32,89;29,87;26,81;29,77];
        P{end+1}=[29,77;34,79;36,82;36,86];
        P{end+1}=[36,86;37,79;43,84;49,85];
        P{end+1}=[49,85;47,81;45,80;30,71];
        P{end+1}=[30,71;26,70;28,69;26,74];
        P{end+1}=[26,74;23,72;16,75;17,66];
        P{end+1}=[17,66;11,74;6,68;4,68];
        P{end+1}=[4,68;6,66;3,58;13,59];
        P{end+1}=[13,59;6,57;8,50;10,47];
        P{end+1}=[10,47;12,49;20,45;19,55];
        P{end+1}=[19,55;22,53;22,48;32,53];
        P{end+1}=[32,53;30,57;32,59;28,61];
        P{end+1}=[28,61;32,73;23,65;38,74];
        P{end+1}=[38,74;38,69;34,70;30,67];
        P{end+1}=[30,67;33,65;32,58;40,60];
        P{end+1}=[40,60;36,57;37,53;41,49];
        P{end+1}=[41,49;45,51;50,50;47,57];
        P{end+1}=[47,57;55,50;57,56;59,56];
        P{end+1}=[59,56;56,59;58,64;49,63];
        P{end+1}=[49,63;55,69;49,71;48,74];
        P{end+1}=[48,74;42,71;39,72;38,74];
        P{end+1}=[38,74;50,80;54,84;62,93];
        P{end+1}=[62,93;62,90;66,90;65,87];
        P{end+1}=[65,87;63,83;69,78;66,75];
        P{end+1}=[66,75;63,72;65,68;64,68];
        P{end+1}=[64,68;67,70;71,66;73,74];
        P{end+1}=[73,74;74,72;73,67;82,70];
        P{end+1}=[82,70;81,74;85,77;78,78];
        P{end+1}=[78,78;86,82;82,85;83,87];
        P{end+1}=[83,87;80,86;79,89;76,86];
        P{end+1}=[76,86;75,88;74,87;71,89];
        P{end+1}=[71,89;68,88;63,91;64,96];
        P{end+1}=[64,96;77,115;87,136;103,179];
        P{end+1}=[103,179;109,172;104,171;111,159];
        P{end+1}=[111,159;118,156;112,152;130,152];
        P{end+1}=[130,152;131,152;130,153;130,154];
        P{end+1}=[130,154;116,176;117,167;114,172];
        P{end+1}=[114,172;107,178;110,170;104,181];
        P{end+1}=[104,181;122,219;148,226;140,232];
    case 9 %G
        P{1}=[172,152;172,152;172,123;172,123];
        P{end+1}=[172,123;172,112;172,105;154,102];
        P{end+1}=[154,102;154,102;223,102;223,102];
        P{end+1}=[223,102;206,105;206,112;206,123];
        P{end+1}=[206,123;206,123;206,152;206,152];
        P{end+1}=[206,152;125,185;68,147;69,93];
        P{end+1}=[69,93;71,22;142,7;180,24];
        P{end+1}=[180,24;193,30;202,30;206,18];
        P{end+1}=[206,18;206,18;206,67;206,67];
        P{end+1}=[206,67;199,47;174,25;151,25];
        P{end+1}=[151,25;120,25;107,52;106,92];
        P{end+1}=[106,92;106,132;120,169;172,152];
end



p = 3;
num=200;

for i=1:length(P)
    cp{i,1}=redraw(p,P{i});%根据控制顶点重新绘制曲线
end


curve=cell2mat(cp);
curve(:,2)=max(curve(:,2))-curve(:,2);
for i=1:length(P)
    cp{i}(:,2)=max(curve(:,2))-cp{i}(:,2);
end
% jianju(1)=norm(curve(end,:)-curve(1,:));
% l(1)=jianju(1);
% for i=2:length(curve)
%     jianju(i)=norm(curve(i,:)-curve(i-1,:));
%     l(i)=l(i-1)+jianju(i);
% end
jianju(length(curve))=norm(curve(end,:)-curve(1,:));

for i=2:length(curve)
    jianju(i-1)=norm(curve(i,:)-curve(i-1,:));
end
l(1)=jianju(1);
for i=2:length(curve)
    l(i)=l(i-1)+jianju(i);
end

for i=1:length(cp)
    %     j=1+(i-1)*200:i*200;
    lcp(1,i)=jianju(1+(i-1)*5000);
    for j=2:5000
        lcp(j,i)=lcp(j-1,i)+jianju(j+(i-1)*5000);
    end
    %     j=1+(i-1)*200:i*200;
    %     lcp(i)=sum(jianju(j));
    ratecp(i)=lcp(end,i)/l(end);
    gpcp{i,1}=cp{i}(1,:);
end
ncptemp=ratecp*num;
ncp(1)=round(ncptemp(1));
for i=2:length(ncptemp)-1
    ncp(i)=round(ncp(i-1)+ncptemp(i))-ncp(i-1);
end
ncp(end+1)=num-sum(ncp);

cpinterval=lcp(end,:)./ncp;
for i=1:size(lcp,2)
    counter=1;
    for j=1:size(lcp,1)-1
        if floor(lcp(j,i)/(counter*cpinterval(i)))
            counter=counter+1;
            %             if j==size(lcp,1)
            %             else
            gpcp{i}(counter,:)=cp{i}(j+1,:);
            %             end
        end
    end
end

gpoint=cell2mat(gpcp);
fenduandian=cumsum(ncp);
fenduandian=1+[0 fenduandian(1:end-1)]';
gpointname=['G-',num2str(num),'.mat'];
save (gpointname,'gpoint','num','fenduandian')
% %
% for i=1:length(gpoint)
%     pause(0.01)
%     plot(gpoint(i,1),gpoint(i,2),'.')
%     hold on
% end
%








% gpinterval=l(end)/num;
% for i=1:size(lcp,2)
%     counter=1;
%     for j=1:size(lcp,1)
%         if floor(lcp(j,i)/(counter*gpinterval))
%             counter=counter+1;
%             gpcp{i}(counter,:)=cp{i}(j,:);
% %             if lcp(end,i)-lcp(j,i)<gpinterval
% %                 gpcp{i}(counter,:)=[];
% %             end
%         end
%     end
% end
% if norm(gpcp{1}(1,:)-gpcp{end}(end,:))<gpinterval
%     gpcp{end}(end,:)=[];
% end
% for i=2:length(gpcp)
%     if norm(gpcp{i}(1,:)-gpcp{i-1}(end,:))<gpinterval
%         gpcp{i-1}(end,:)=[];
%     end
% end



















% for i=1:length(curve)
% pause(0.02)
% plot(curve(i,1),curve(i,2),'.');
% hold on
% end

function p_u=redraw(p,P)

n = length(P)-1;

ui=jiedianxiangliang(n,p,0,1); % 准均匀B样条的节点矢量

Njp_u = zeros(1, n+1);
j=0;
for u = 0 : 0.0002 : 1-0.0002
    j=j+1;
    %     p_u=zeros(length(u),2);
    for i = 1 : n+1
        Njp_u(j, i) = Njp(i, p , u, ui);
    end
    p_u(j,:) = Njp_u(j,:)*P;
    
end
end
